<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">













  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">







  

<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: true,
    fastclick: true,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="å¿ƒæ¯”è¾ƒä¹±ï¼Œå·¥ä½œä¸Šä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿è¦åšï¼Œæ¯”è¾ƒçƒ¦ï¼Œé¢†å¯¼ä¹‹å‰è¯´é‚£ä¸ªäº‹æƒ…è¿˜æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå…ˆåšä¸ªçˆ¬è™«è¯•è¯•å§ï¼Œæ‰“å‘æ— èŠæ—¶å…‰è¿™é‡Œçœ‹åˆ°äº†yieldå…³é”®å­—,pythonçš„ä¸œè¥¿è¿˜æ˜¯ä¸ç†Ÿ,ç™¾åº¦äº†ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸ªæ¦‚å¿µ,æ…¢æ…¢ç ”ç©¶,å…ˆæ”¾ä¸ªé“¾æ¥markä¸€ä¸‹">
<meta name="keywords" content="python,spider,Scrapy">
<meta property="og:type" content="article">
<meta property="og:title" content="Scrapyå…¥é—¨">
<meta property="og:url" content="https://liudongmeng.github.io/2017/04/08/Scrapyå…¥é—¨/index.html">
<meta property="og:site_name" content="Hisashiburidane">
<meta property="og:description" content="å¿ƒæ¯”è¾ƒä¹±ï¼Œå·¥ä½œä¸Šä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿è¦åšï¼Œæ¯”è¾ƒçƒ¦ï¼Œé¢†å¯¼ä¹‹å‰è¯´é‚£ä¸ªäº‹æƒ…è¿˜æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå…ˆåšä¸ªçˆ¬è™«è¯•è¯•å§ï¼Œæ‰“å‘æ— èŠæ—¶å…‰è¿™é‡Œçœ‹åˆ°äº†yieldå…³é”®å­—,pythonçš„ä¸œè¥¿è¿˜æ˜¯ä¸ç†Ÿ,ç™¾åº¦äº†ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸ªæ¦‚å¿µ,æ…¢æ…¢ç ”ç©¶,å…ˆæ”¾ä¸ªé“¾æ¥markä¸€ä¸‹">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://liudongmeng.github.io/2017/04/08/Scrapyå…¥é—¨/scrapy_architecture_02.png">
<meta property="og:updated_time" content="2018-09-08T09:20:09.767Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Scrapyå…¥é—¨">
<meta name="twitter:description" content="å¿ƒæ¯”è¾ƒä¹±ï¼Œå·¥ä½œä¸Šä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿è¦åšï¼Œæ¯”è¾ƒçƒ¦ï¼Œé¢†å¯¼ä¹‹å‰è¯´é‚£ä¸ªäº‹æƒ…è¿˜æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå…ˆåšä¸ªçˆ¬è™«è¯•è¯•å§ï¼Œæ‰“å‘æ— èŠæ—¶å…‰è¿™é‡Œçœ‹åˆ°äº†yieldå…³é”®å­—,pythonçš„ä¸œè¥¿è¿˜æ˜¯ä¸ç†Ÿ,ç™¾åº¦äº†ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸ªæ¦‚å¿µ,æ…¢æ…¢ç ”ç©¶,å…ˆæ”¾ä¸ªé“¾æ¥markä¸€ä¸‹">
<meta name="twitter:image" content="https://liudongmeng.github.io/2017/04/08/Scrapyå…¥é—¨/scrapy_architecture_02.png">



  <link rel="alternate" href="/atom.xml" title="Hisashiburidane" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://liudongmeng.github.io/2017/04/08/Scrapyå…¥é—¨/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Scrapyå…¥é—¨ | Hisashiburidane</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hisashiburidane</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">å¥½ä¹…ä¸è§</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">20</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">24</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">24</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">

    
    
      
    

    
      
    

    <a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>Commonweal 404</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://liudongmeng.github.io/2017/04/08/Scrapyå…¥é—¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hisashiburidane">
      <meta itemprop="description" content="åŠªåŠ›,å¥‹æ–—">
      <meta itemprop="image" content="/images/hollow_knight.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hisashiburidane">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Scrapyå…¥é—¨

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-08 10:39:38" itemprop="dateCreated datePublished" datetime="2017-04-08T10:39:38+08:00">2017-04-08</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-08 17:20:09" itemprop="dateModified" datetime="2018-09-08T17:20:09+08:00">2018-09-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ç¬”è®°/" itemprop="url" rel="index"><span itemprop="name">ç¬”è®°</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ç¬”è®°/Scrapy/" itemprop="url" rel="index"><span itemprop="name">Scrapy</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/04/08/Scrapyå…¥é—¨/" class="post-meta-item leancloud_visitors" data-flag-title="Scrapyå…¥é—¨">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>å¿ƒæ¯”è¾ƒä¹±ï¼Œå·¥ä½œä¸Šä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿è¦åšï¼Œæ¯”è¾ƒçƒ¦ï¼Œé¢†å¯¼ä¹‹å‰è¯´é‚£ä¸ªäº‹æƒ…è¿˜æ²¡ä»€ä¹ˆæ€è·¯ï¼Œå…ˆåšä¸ªçˆ¬è™«è¯•è¯•å§ï¼Œæ‰“å‘æ— èŠæ—¶å…‰<br>è¿™é‡Œçœ‹åˆ°äº†yieldå…³é”®å­—,pythonçš„ä¸œè¥¿è¿˜æ˜¯ä¸ç†Ÿ,ç™¾åº¦äº†ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸ªæ¦‚å¿µ,æ…¢æ…¢ç ”ç©¶,å…ˆæ”¾ä¸ª<a href="http://www.jianshu.com/p/d09778f4e055" title="å½»åº•ç†è§£Pythonä¸­çš„yield" target="_blank" rel="noopener">é“¾æ¥</a>markä¸€ä¸‹</p>
<a id="more"></a>
<h1 id="æœ€ç®€å•çš„çˆ¬ç½‘é¡µ"><a href="#æœ€ç®€å•çš„çˆ¬ç½‘é¡µ" class="headerlink" title="æœ€ç®€å•çš„çˆ¬ç½‘é¡µ"></a>æœ€ç®€å•çš„çˆ¬ç½‘é¡µ</h1><p>å…ˆè´´ä¸€æ®µä»£ç ï¼Œç®€å•çš„æ²¡ä»€ä¹ˆå¥½è®²</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2.7</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHtml</span><span class="params">(url)</span>:</span></span><br><span class="line">    page = urllib2.urlopen(url)</span><br><span class="line">    html=page.read()</span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line">url=<span class="string">"https://liudongmeng.github.io"</span></span><br><span class="line">html=getHtml(url)</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure>
<h1 id="Scrapy"><a href="#Scrapy" class="headerlink" title="Scrapy"></a>Scrapy</h1><p>ç™¾åº¦äº†ä¸€ä¸‹æ¥ä¸‹æ¥åº”è¯¥æ€ä¹ˆåšï¼Œæ— éå…ˆæ‹‰æ•°æ®ï¼Œç„¶åä½¿ç”¨æ­£åˆ™æˆ–è€…å…¶ä»–æ‰‹æ®µæŠŠç›®æ ‡æ•°æ®æå–å‡ºæ¥ï¼Œä¹‹åè¦èƒ½è‡ªåŠ¨ç¿»é¡µä¹‹ç±»çš„ï¼Œèƒ½å¤ŸæŒç»­æ‹‰<br>è¯´èµ·æ¥ç®€å•ï¼Œè·å–ç½‘é¡µå†…å®¹åªéœ€è¦ç¬¬ä¸€æ­¥é‚£å‡ è¡Œä»£ç ï¼Œç„¶åå°±è¦ä»”ç»†ç¢ç£¨ä¸€ä¸‹æ€ä¹ˆåšäº†ï¼Œç™¾åº¦çš„ç»“æœæ˜¯ç”¨<a href="https://scrapy.org/" title="Scrapyå®˜ç½‘" target="_blank" rel="noopener">Scrapy</a>è¿™ä¸ªæ¡†æ¶çš„æ¯”è¾ƒå¤šï¼Œå…ˆç®€å•å­¦ä¹ ä¸€ä¸‹å§<br><img src="scrapy_architecture_02.png" alt="input"><br>çœ‹å®Œæ–‡æ¡£åˆè¸©äº†å¥½å¤šå‘â€¦â€¦ç°åœ¨å¼€å§‹è¡¥å……<br>é¡ºç€æ–‡æ¡£çœ‹ä¸‹æ¥ï¼Œ<code>pip install</code>æŒ‰è¯´åº”è¯¥å¾ˆç®€å•å•Šï¼Œå¯æ˜¯OSXä¸‹é¢å®‰è£…å°±æ˜¯å‡ºäº†ä¸€å †é—®é¢˜ï¼Œæ¯”å¦‚ç³»ç»Ÿæƒé™äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªä»€ä¹ˆç³»ç»Ÿä¿æŠ¤æœºåˆ¶äº†ï¼Œä¸èƒ½åœ¨usrå’Œetcè¿™ç§ç›®å½•ä¸‹è£…ä¸œè¥¿â€¦â€¦çœ‹äº†ä¸€åœˆï¼Œä¸€ç§è§£å†³åŠæ³•æ˜¯é…ç½®pipå®‰è£…è·¯å¾„ï¼Œè£…åœ¨å½“å‰ç”¨æˆ·çš„ç›®å½•ä¸‹ï¼Œè¦æ”¹ä¸€å †é…ç½®æ–‡ä»¶<br>æœ€åå†³å®šè¦é‡‡ç”¨çš„æ˜¯<a href="https://virtualenv.pypa.io" title="visualenvå®˜ç½‘" target="_blank" rel="noopener">virtualenv</a>ï¼Œå› ä¸ºä¸ç”¨è¿™ä¹ˆéº»çƒ¦â€¦â€¦<br>å†™åœ¨ä¸€èµ·å¤ªä¹±äº†ï¼Œæ”¾ä¸ªé“¾æ¥<a href="/2017/04/08/pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®/" title="pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®">pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®</a></p>
<h2 id="Scrapyå®‰è£…"><a href="#Scrapyå®‰è£…" class="headerlink" title="Scrapyå®‰è£…"></a>Scrapyå®‰è£…</h2><p>æå®šäº†è™šæ‹Ÿç¯å¢ƒï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…é…ç½®Scrapyäº†</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒç›®å½•(?æš‚æ—¶è¿™æ ·å«å§)</span></span><br><span class="line">$ visualenv ENV</span><br><span class="line"><span class="comment"># åˆ‡æ¢è‡³è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ <span class="built_in">source</span> ENV/bin/activate</span><br><span class="line"><span class="comment"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ deactivate</span><br><span class="line"><span class="comment"># pipå®‰è£…</span></span><br><span class="line">$ pip install Scrapy</span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸ºtutorialçš„scrapyé¡¹ç›®</span></span><br><span class="line">$ scrapy startproject tutorial</span><br></pre></td></tr></table></figure>
<h2 id="Scrapy-Tuurtorial"><a href="#Scrapy-Tuurtorial" class="headerlink" title="Scrapy Tuurtorial"></a>Scrapy Tuurtorial</h2><p>ä¸‹é¢æ˜¯<a href="https://docs.scrapy.org/en/latest/intro/tutorial.html" title="Scrapyå®˜ç½‘Tutorial" target="_blank" rel="noopener">Scrapyå®˜ç½‘Tutorial</a>ç»™å‡ºçš„æ•™ç¨‹ä¸­çš„ä»£ç </p>
<h3 id="æŠ“å–ç½‘é¡µ"><a href="#æŠ“å–ç½‘é¡µ" class="headerlink" title="æŠ“å–ç½‘é¡µ"></a>æŠ“å–ç½‘é¡µ</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"quotes"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">        urls = [</span><br><span class="line">            <span class="string">'http://quotes.toscrape.com/page/1/'</span>,</span><br><span class="line">            <span class="string">'http://quotes.toscrape.com/page/2/'</span>,</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=url, callback=self.parse)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        page = response.url.split(<span class="string">"/"</span>)[<span class="number">-2</span>]</span><br><span class="line">        filename = <span class="string">'quotes-%s.html'</span> % page</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.body)</span><br><span class="line">        self.log(<span class="string">'Saved file %s'</span> % filename)</span><br></pre></td></tr></table></figure>
<p>ä¹‹ååœ¨tutorialç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy crawl quotes</span><br><span class="line"><span class="comment"># This command runs the spider with name quotes that weâ€™ve just added, that will send some requests for the quotes.toscrape.com domain. You will get an output similar to this:</span></span><br><span class="line">... (omitted <span class="keyword">for</span> brevity)</span><br><span class="line">2016-12-16 21:24:05 [scrapy.core.engine] INFO: Spider opened</span><br><span class="line">2016-12-16 21:24:05 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min)</span><br><span class="line">2016-12-16 21:24:05 [scrapy.extensions.telnet] DEBUG: Telnet console listening on 127.0.0.1:6023</span><br><span class="line">2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (404) &lt;GET http://quotes.toscrape.com/robots.txt&gt; (referer: None)</span><br><span class="line">2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quotes.toscrape.com/page/1/&gt; (referer: None)</span><br><span class="line">2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quotes.toscrape.com/page/2/&gt; (referer: None)</span><br><span class="line">2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-1.html</span><br><span class="line">2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-2.html</span><br><span class="line">2016-12-16 21:24:05 [scrapy.core.engine] INFO: Closing spider (finished)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Scrapy schedules the scrapy.Request objects returned by the start_requests method of the Spider. Upon receiving a response for each one, it instantiates Response objects and calls the callback method associated with the request (in this case, the parse method) passing the response as argument.</p>
</blockquote>
<p>è¿™æ—¶å€™ENVç›®å½•ä¸‹ä¿å­˜äº†ä¸¤ä¸ªhtmlæ–‡ä»¶<code>quotes-1.html</code>,<code>quotes-2.html</code>,è¿™å°±æ˜¯çˆ¬ä¸‹æ¥çš„ä¸œè¥¿äº†</p>
<p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"quotes_shortcut"</span></span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">'http://quotes.toscrape.com/page/1/'</span>,</span><br><span class="line">        <span class="string">'http://quotes.toscrape.com/page/2/'</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self,response)</span>:</span></span><br><span class="line">        page = response.url.split(<span class="string">"/"</span>)[<span class="number">-2</span>]</span><br><span class="line">        finename = <span class="string">'quotes_shortcut-%s.html'</span> % page</span><br><span class="line">        <span class="keyword">with</span> open(finename,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.body)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The parse() method will be called to handle each of the requests for those URLs, even though we havenâ€™t explicitly told Scrapy to do so. This happens because parse() is Scrapyâ€™s default callback method, which is called for requests without an explicitly assigned callback.</p>
</blockquote>
<p>çœ‹äº†ä¸€ä¸‹,è¿™ä¸€æ®µå¤§æ¦‚æ˜¯ä¸ºäº†è¯´æ˜parseæ˜¯scrapyçš„é»˜è®¤å›è°ƒå‡½æ•°,ä¸éœ€è¦ä¸‹é¢è¿™ä¸€æ®µä»£ç æŒ‡å®šä¹Ÿä¼šè¢«é»˜è®¤è°ƒç”¨</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    <span class="keyword">yield</span> scrapy.Request(url=url, callback=self.parse)</span><br></pre></td></tr></table></figure>
<h3 id="CSSSelectoræå–æ•°æ®"><a href="#CSSSelectoræå–æ•°æ®" class="headerlink" title="CSSSelectoræå–æ•°æ®"></a>CSSSelectoræå–æ•°æ®</h3><p>ç„¶åæ˜¯è®²scrapyå¦‚ä½•æå–æ•°æ®çš„</p>
<h4 id="extract-method"><a href="#extract-method" class="headerlink" title=".extract() method"></a>.extract() method</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scrapy shell</span></span><br><span class="line">$ scrapy shell <span class="string">'http://quotes.toscrape.com/page/1/'</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œå®Œæ¯•ä¹‹åçœ‹åˆ°å¦‚ä¸‹è¾“å‡º</span></span><br><span class="line">[ ... Scrapy <span class="built_in">log</span> here ... ]</span><br><span class="line">2016-09-19 12:09:27 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quotes.toscrape.com/page/1/&gt; (referer: None)</span><br><span class="line">[s] Available Scrapy objects:</span><br><span class="line">[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)</span><br><span class="line">[s]   crawler    &lt;scrapy.crawler.Crawler object at 0x7fa91d888c90&gt;</span><br><span class="line">[s]   item       &#123;&#125;</span><br><span class="line">[s]   request    &lt;GET http://quotes.toscrape.com/page/1/&gt;</span><br><span class="line">[s]   response   &lt;200 http://quotes.toscrape.com/page/1/&gt;</span><br><span class="line">[s]   settings   &lt;scrapy.settings.Settings object at 0x7fa91d888c10&gt;</span><br><span class="line">[s]   spider     &lt;DefaultSpider <span class="string">'default'</span> at 0x7fa91c8af990&gt;</span><br><span class="line">[s] Useful shortcuts:</span><br><span class="line">[s]   shelp()           Shell <span class="built_in">help</span> (<span class="built_in">print</span> this <span class="built_in">help</span>)</span><br><span class="line">[s]   fetch(req_or_url) Fetch request (or URL) and update <span class="built_in">local</span> objects</span><br><span class="line">[s]   view(response)    View response <span class="keyword">in</span> a browser</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥å¯ä»¥åœ¨scrapy shellä¸­è¿›è¡Œä¸€äº›å‘½ä»¤æ“ä½œ</span></span><br><span class="line"><span class="comment"># css selector</span></span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'tittle'</span>)</span><br><span class="line">[&lt;Selector xpath=u<span class="string">'descendant-or-self::title'</span> data=u<span class="string">'&lt;title&gt;Quotes to Scrape&lt;/title&gt;'</span>&gt;]</span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'tittle::text'</span>)</span><br><span class="line">[&lt;Selector xpath=u<span class="string">'descendant-or-self::title/text()'</span> data=u<span class="string">'Quotes to Scrape'</span>&gt;]</span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title::text'</span>).extract()</span><br><span class="line">[u<span class="string">'Quotes to Scrape'</span>]</span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title'</span>).extract()</span><br><span class="line">[u<span class="string">'&lt;title&gt;Quotes to Scrape&lt;/title&gt;'</span>]</span><br><span class="line"><span class="comment"># extract()æ–¹æ³•å¤„ç†çš„æ˜¯ä¸€ä¸ªselectorListå®ä¾‹,å¦‚æœåªæƒ³è¦ç¬¬ä¸€ä¸ªç»“æœå¯ä»¥å¦‚ä¸‹æ“ä½œ</span></span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title::text'</span>).extract_first()</span><br><span class="line">u<span class="string">'Quotes to Scrape'</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥åƒæ•°ç»„ä¸€æ ·å†™</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨.extract_first()æ–¹æ³•åœ¨æ•°ç»„é•¿åº¦ä¸º0(æ²¡æœ‰æ‰¾åˆ°å¯¹åº”é€‰æ‹©å™¨çš„å…ƒç´ )çš„æ—¶å€™å¯ä»¥è¿”å›Noneè€Œä¸æ˜¯å¼•å‘ç´¢å¼•é”™è¯¯</span></span><br><span class="line"><span class="comment"># However, using .extract_first() avoids an IndexError and returns None when it doesnâ€™t find any element matching the selection.</span></span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title::text'</span>)[0].extract()</span><br><span class="line">u<span class="string">'Quotes to Scrape'</span></span><br></pre></td></tr></table></figure>
<h4 id="regular-expressions"><a href="#regular-expressions" class="headerlink" title="regular expressions"></a>regular expressions</h4><blockquote>
<p>Besides the extract() and extract_first() methods, you can also use the re() method to extract using regular expressions:</p>
</blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼æå–æ•°æ®</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title::text'</span>).re(r<span class="string">'Quotes.*'</span>)</span><br><span class="line">[u<span class="string">'Quotes to Scrape'</span>]</span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title::text'</span>).re(r<span class="string">'Q\w+'</span>)</span><br><span class="line">[u<span class="string">'Quotes'</span>]</span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'title::text'</span>).re(r<span class="string">'(\w+) to (\w+)'</span>)</span><br><span class="line">[u<span class="string">'Quotes'</span>, <span class="string">'Scrape'</span>]</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†éªŒè¯æå–åˆ°çš„æ•°æ®æ˜¯å¦æ­£ç¡®,å¯ä»¥è°ƒç”¨<code>view(response)</code>æ–¹æ³•æ‰“å¼€æµè§ˆå™¨,åœ¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹é¡µé¢å…ƒç´ </p>
<h3 id="XPathæå–æ•°æ®"><a href="#XPathæå–æ•°æ®" class="headerlink" title="XPathæå–æ•°æ®"></a>XPathæå–æ•°æ®</h3><p>è¿™ä¸€å—ä¹‹å‰åœ¨åšseleniumçš„ç«¯å¯¹ç«¯æµ‹è¯•çš„æ—¶å€™æœ‰ä¸€ç‚¹ç‚¹äº†è§£,å¯ä»¥ç”¨çš„æ—¶å€™å†ç™¾åº¦</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; response.xpath(<span class="string">'//title'</span>)</span><br><span class="line">[&lt;Selector xpath=<span class="string">'//title'</span> data=u<span class="string">'&lt;title&gt;Quotes to Scrape&lt;/title&gt;'</span>&gt;]</span><br><span class="line">&gt;&gt;&gt; response.xpath(<span class="string">'//title/text()'</span>).extract_first()</span><br><span class="line">u<span class="string">'Quotes to Scrape'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>XPath expressions are very powerful, and are the foundation of Scrapy Selectors. In fact, CSS selectors are converted to XPath under-the-hood. You can see that if you read closely the text representation of the selector objects in the shell.</p>
</blockquote>
<p>è¿™é‡Œè¯´XPathæ˜¯CSSSelectorçš„åŸºç¡€,æ„æ€æ˜¯æ›´å¼ºå¤§äº†</p>
<h3 id="è¿™é‡Œè®²å¦‚ä½•æå–æœ€ç»ˆçš„ç›®æ ‡æ•°æ®"><a href="#è¿™é‡Œè®²å¦‚ä½•æå–æœ€ç»ˆçš„ç›®æ ‡æ•°æ®" class="headerlink" title="è¿™é‡Œè®²å¦‚ä½•æå–æœ€ç»ˆçš„ç›®æ ‡æ•°æ®"></a>è¿™é‡Œè®²å¦‚ä½•æå–æœ€ç»ˆçš„ç›®æ ‡æ•°æ®</h3><p>è¿™ç¯‡æ•™ç¨‹ä¸­çš„ç›®çš„æ˜¯ä»ç½‘ç«™ä¸­æŠ“å–ä½œå“å’Œä½œè€…æ•°æ®,æˆ‘çŒœæ˜¯ç”¨æ­£åˆ™ğŸ™„<br>æŠ“åˆ°çš„ç½‘ç«™æ•°æ®æ ¼å¼å¦‚ä¸‹</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"quote"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>â€œThe world as we have created it is a process of our</span><br><span class="line">    thinking. It cannot be changed without changing our thinking.â€<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">        by <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"author"</span>&gt;</span>Albert Einstein<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/author/Albert-Einstein"</span>&gt;</span>(about)<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tags"</span>&gt;</span></span><br><span class="line">        Tags:</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"tag"</span> <span class="attr">href</span>=<span class="string">"/tag/change/page/1/"</span>&gt;</span>change<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"tag"</span> <span class="attr">href</span>=<span class="string">"/tag/deep-thoughts/page/1/"</span>&gt;</span>deep-thoughts<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"tag"</span> <span class="attr">href</span>=<span class="string">"/tag/thinking/page/1/"</span>&gt;</span>thinking<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"tag"</span> <span class="attr">href</span>=<span class="string">"/tag/world/page/1/"</span>&gt;</span>world<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé‡æ–°æ‰“å¼€scrapy shell</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy shell <span class="string">'http://quotes.toscrape.com'</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨CSSSelectorè·å–åˆ°äº†æ‰€æœ‰çš„div.quoteå…ƒç´ å¯¹è±¡</span></span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">"div.quote"</span>)</span><br><span class="line"><span class="comment"># quoteç°åœ¨å°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹è±¡</span></span><br><span class="line">&gt;&gt;&gt; quote=response.css(<span class="string">"div.quote"</span>)[0]</span><br><span class="line">&gt;&gt;&gt; quote</span><br><span class="line">&lt;Selector xpath=u<span class="string">"descendant-or-self::div[@class and contains(concat(' ', normalize-space(@class), ' '), ' quote ')]"</span> data=u<span class="string">'&lt;div class="quote" itemscope itemtype="h'</span>&gt;</span><br><span class="line"><span class="comment"># ç„¶åæ ¹æ®quoteçš„å…ƒç´ å»æŸ¥æ‰¾ä¸‹é¢çš„å…ƒç´ </span></span><br><span class="line">&gt;&gt;&gt; title = quote.css(<span class="string">"span.text::text"</span>).extract_first()</span><br><span class="line">&gt;&gt;&gt; title</span><br><span class="line">u<span class="string">'\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d'</span></span><br><span class="line">&gt;&gt;&gt; author = quote.css(<span class="string">"small.author::text"</span>).extract_first()</span><br><span class="line">&gt;&gt;&gt; author</span><br><span class="line"><span class="string">'Albert Einstein'</span></span><br><span class="line">&gt;&gt;&gt; tags = quote.css(<span class="string">"div.tags a.tag::text"</span>).extract()</span><br><span class="line">&gt;&gt;&gt; tags</span><br><span class="line">[u<span class="string">'change'</span>, u<span class="string">'deep-thoughts'</span>, u<span class="string">'thinking'</span>, u<span class="string">'world'</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> quote <span class="keyword">in</span> response.css(<span class="string">"div.quote"</span>):</span><br><span class="line">...     text=quote.css(<span class="string">"span.text::text"</span>).extract_first()</span><br><span class="line">...     author=quote.css(<span class="string">"small.author::text"</span>).extract_first()</span><br><span class="line">...     tags=quote.css(<span class="string">"div.tags a.tag::text"</span>).extract()</span><br><span class="line">...     <span class="built_in">print</span>(dict(text=text,author=author,tags=tags))</span><br><span class="line">...</span><br><span class="line">&#123;<span class="string">'text'</span>: u<span class="string">'\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d'</span>, <span class="string">'tags'</span>: [u<span class="string">'change'</span>, u<span class="string">'deep-thoughts'</span>, u<span class="string">'thinking'</span>, u<span class="string">'world'</span>], <span class="string">'author'</span>: u<span class="string">'Albert Einstein'</span>&#125;</span><br><span class="line">&#123;<span class="string">'text'</span>: u<span class="string">'\u201cIt is our choices, Harry, that show what we truly are, far more than our abilities.\u201d'</span>, <span class="string">'tags'</span>: [u<span class="string">'abilities'</span>, u<span class="string">'choices'</span>], <span class="string">'author'</span>: u<span class="string">'J.K. Rowling'</span>&#125;</span><br><span class="line">... a few more of these, omitted <span class="keyword">for</span> brevity</span><br></pre></td></tr></table></figure>
<h3 id="åœ¨Spiderä¸­æå–æ•°æ®"><a href="#åœ¨Spiderä¸­æå–æ•°æ®" class="headerlink" title="åœ¨Spiderä¸­æå–æ•°æ®"></a>åœ¨Spiderä¸­æå–æ•°æ®</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"quotes_extract"</span></span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">'http://quotes.toscrape.com/page/1/'</span>,</span><br><span class="line">        <span class="string">'http://quotes.toscrape.com/page/2/'</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> quote <span class="keyword">in</span> response.css(<span class="string">'div.quote'</span>):</span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">'text'</span>: quote.css(<span class="string">'span.text::text'</span>).extract_first(),</span><br><span class="line">                <span class="string">'author'</span>: quote.css(<span class="string">'small.author::text'</span>).extract_first(),</span><br><span class="line">                <span class="string">'tags'</span>: quote.css(<span class="string">'div.tags a.tag::text'</span>).extract(),</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç¨‹åºçœ‹è¾“å‡º,å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy crawl quotes_extract</span><br><span class="line">...</span><br><span class="line">2017-04-08 22:00:06 [scrapy.core.scraper] DEBUG: Scraped from &lt;200 http://quotes.toscrape.com/page/1/&gt;</span><br><span class="line">&#123;<span class="string">'text'</span>: u<span class="string">'\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d'</span>, <span class="string">'tags'</span>: [u<span class="string">'change'</span>, u<span class="string">'deep-thoughts'</span>, u<span class="string">'thinking'</span>, u<span class="string">'world'</span>], <span class="string">'author'</span>: u<span class="string">'Albert Einstein'</span>&#125;</span><br><span class="line">2017-04-08 22:00:06 [scrapy.core.scraper] DEBUG: Scraped from &lt;200 http://quotes.toscrape.com/page/1/&gt;</span><br><span class="line">&#123;<span class="string">'text'</span>: u<span class="string">'\u201cIt is our choices, Harry, that show what we truly are, far more than our abilities.\u201d'</span>, <span class="string">'tags'</span>: [u<span class="string">'abilities'</span>, u<span class="string">'choices'</span>], <span class="string">'author'</span>: u<span class="string">'J.K. Rowling'</span>&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment"># è¾“å‡ºjsonæ–‡ä»¶</span></span><br><span class="line">$ scrapy crawl quotes_extract -o quotes_extract.json</span><br><span class="line"><span class="comment"># è¾“å‡ºjlæ–‡ä»¶</span></span><br><span class="line">$ scrapy crawl quotes_extract -o quotes_extract.jl</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The JSON Lines format is useful because itâ€™s stream-like, you can easily append new records to it. It doesnâ€™t have the same problem of JSON when you run twice. Also, as each record is a separate line, you can process big files without having to fit everything in memory, there are tools like JQ to help doing that at the command-line.</p>
</blockquote>
<p>è¿™é‡Œç»ˆç«¯å’Œä¸Šé¢çš„è¾“å‡ºæ˜¯ä¸€æ ·çš„,åªæ˜¯æŠŠæ•°æ®ä¿å­˜åœ¨äº†jsonæ–‡ä»¶é‡Œ,éšä¾¿åˆ—å‡ æ¡çœ‹çœ‹æ•ˆæœå°±è¡Œäº†</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;<span class="attr">"text"</span>: <span class="string">"\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d"</span>, <span class="attr">"author"</span>: <span class="string">"Albert Einstein"</span>, <span class="attr">"tags"</span>: [<span class="string">"change"</span>, <span class="string">"deep-thoughts"</span>, <span class="string">"thinking"</span>, <span class="string">"world"</span>]&#125;,</span><br><span class="line">&#123;<span class="attr">"text"</span>: <span class="string">"\u201cIt is our choices, Harry, that show what we truly are, far more than our abilities.\u201d"</span>, <span class="attr">"author"</span>: <span class="string">"J.K. Rowling"</span>, <span class="attr">"tags"</span>: [<span class="string">"abilities"</span>, <span class="string">"choices"</span>]&#125;,</span><br><span class="line">&#123;<span class="attr">"text"</span>: <span class="string">"\u201cThere are only two ways to live your life. One is as though nothing is a miracle. The other is as though everything is a miracle.\u201d"</span>, <span class="attr">"author"</span>: <span class="string">"Albert Einstein"</span>, <span class="attr">"tags"</span>: [<span class="string">"inspirational"</span>, <span class="string">"life"</span>, <span class="string">"live"</span>, <span class="string">"miracle"</span>, <span class="string">"miracles"</span>]&#125;,</span><br><span class="line">&#123;<span class="attr">"text"</span>: <span class="string">"\u201cThe person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.\u201d"</span>, <span class="attr">"author"</span>: <span class="string">"Jane Austen"</span>, <span class="attr">"tags"</span>: [<span class="string">"aliteracy"</span>, <span class="string">"books"</span>, <span class="string">"classic"</span>, <span class="string">"humor"</span>]&#125;,</span><br><span class="line">&#123;<span class="attr">"text"</span>: <span class="string">"\u201cImperfection is beauty, madness is genius and it's better to be absolutely ridiculous than absolutely boring.\u201d"</span>, <span class="attr">"author"</span>: <span class="string">"Marilyn Monroe"</span>, <span class="attr">"tags"</span>: [<span class="string">"be-yourself"</span>, <span class="string">"inspirational"</span>]&#125;,</span><br><span class="line">&#123;<span class="attr">"text"</span>: <span class="string">"\u201cTry not to become a man of success. Rather become a man of value.\u201d"</span>, <span class="attr">"author"</span>: <span class="string">"Albert Einstein"</span>, <span class="attr">"tags"</span>: [<span class="string">"adulthood"</span>, <span class="string">"success"</span>, <span class="string">"value"</span>]&#125;,</span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>In small projects (like the one in this tutorial), that should be enough. However, if you want to perform more complex things with the scraped items, you can write an Item Pipeline. A placeholder file for Item Pipelines has been set up for you when the project is created, in tutorial/pipelines.py. Though you donâ€™t need to implement any item pipelines if you just want to store the scraped items.</p>
</blockquote>
<p>è¿™ä¸ªæ˜¯ç®¡é“äº†,è¿™éƒ¨åˆ†å›å¤´å†çœ‹å§,ä»Šå¤©å…ˆåˆ°è¿™é‡Œ.ä¹ˆæœ‰æ•ˆç‡â€¦</p>
<h3 id="å¦‚ä½•æŒç»­æŸ¥æ‰¾æ‰€æœ‰ç½‘é¡µ"><a href="#å¦‚ä½•æŒç»­æŸ¥æ‰¾æ‰€æœ‰ç½‘é¡µ" class="headerlink" title="å¦‚ä½•æŒç»­æŸ¥æ‰¾æ‰€æœ‰ç½‘é¡µ"></a>å¦‚ä½•æŒç»­æŸ¥æ‰¾æ‰€æœ‰ç½‘é¡µ</h3><p>è¿™é‡Œåº”è¯¥å°±æ˜¯æ‰¾åˆ°â€ä¸‹ä¸€é¡µâ€çš„æ ‡è®°,ç„¶åæ— é™å‘ä¸‹ç›´åˆ°æ²¡æœ‰ä¸‹ä¸€é¡µä¸ºæ­¢,ä¹Ÿæ²¡ä»€ä¹ˆéš¾åº¦,æŒ‡å®šé€‰æ‹©å™¨è€Œå·².<br>ä¸‹é¢æ˜¯quotesç½‘ç«™çš„ä¸‹ä¸€é¡µå…ƒç´ </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"next"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/page/2/"</span>&gt;</span>Next <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>&amp;rarr;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>shellé‡Œé¢å…ˆçœ‹çœ‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy shell <span class="string">'http://quotes.toscrape.com/'</span></span><br><span class="line">&gt;&gt;&gt; response.css(<span class="string">'li.next a::attr(href)'</span>).extract_first()</span><br><span class="line">u<span class="string">'/page/2/'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"quotes_next"</span></span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">'http://quotes.toscrape.com/page/1/'</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> quote <span class="keyword">in</span> response.css(<span class="string">'div.quote'</span>):</span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">'text'</span>: quote.css(<span class="string">'span.text::text'</span>).extract_first(),</span><br><span class="line">                <span class="string">'author'</span>: quote.css(<span class="string">'small.author::text'</span>).extract_first(),</span><br><span class="line">                <span class="string">'tags'</span>: quote.css(<span class="string">'div.tags a.tag::text'</span>).extract(),</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        next_page = response.css(<span class="string">'li.next a::attr(href)'</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> next_page <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="comment"># ä»ç›¸å¯¹è·¯å¾„è·å–é¡µé¢çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">            <span class="comment"># http://quotes.toscrape.com/page/1/</span></span><br><span class="line">            <span class="comment"># /page/2/</span></span><br><span class="line">            <span class="comment"># æ‹¼èµ·æ¥å°±æ˜¯http://quotes.toscrape.com/page/2/è¿™æ ·</span></span><br><span class="line">            next_page = response.urljoin(next_page)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(next_page, callback=self.parse)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>What you see here is Scrapyâ€™s mechanism of following links: when you yield a Request in a callback method, Scrapy will schedule that request to be sent and register a callback method to be executed when that request finishes.</p>
</blockquote>
<p>scrapyå›è°ƒparseçš„æ—¶å€™ä¼šè§¦å‘next_pageä¸‹é¢çš„<code>scrapy.Request(next_page, callback=self.parse)</code>ä»£ç ,å¾ªç¯ç›´åˆ°<code>next_page=None</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'quotes_author'</span></span><br><span class="line"></span><br><span class="line">    start_urls = [<span class="string">'http://quotes.toscrape.com/'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment"># follow links to author pages</span></span><br><span class="line">        <span class="keyword">for</span> href <span class="keyword">in</span> response.css(<span class="string">'.author + a::attr(href)'</span>).extract():</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(response.urljoin(href),</span><br><span class="line">                                 callback=self.parse_author)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># follow pagination links</span></span><br><span class="line">        next_page = response.css(<span class="string">'li.next a::attr(href)'</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> next_page <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            next_page = response.urljoin(next_page)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(next_page, callback=self.parse)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_author</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">extract_with_css</span><span class="params">(query)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> response.css(query).extract_first().strip()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'name'</span>: extract_with_css(<span class="string">'h3.author-title::text'</span>),</span><br><span class="line">            <span class="string">'birthdate'</span>: extract_with_css(<span class="string">'.author-born-date::text'</span>),</span><br><span class="line">            <span class="string">'bio'</span>: extract_with_css(<span class="string">'.author-description::text'</span>),</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µæ˜¯å…ˆåŠ è½½é¡µé¢ä¹‹åæ‹¿åˆ°æ‰€æœ‰çš„ä½œè€…çš„é“¾æ¥,ç„¶ååœ¨parseä¸­æ–°å»ºscrapy.Request()è¯·æ±‚,è§¦å‘parse_authorå›è°ƒ,åœ¨ä½œè€…é¡µé¢ä¸­æ‹¿åˆ°ä½œè€…ä¿¡æ¯<br>æˆ‘åœ¨æƒ³è¿™ä¸ªä¸œè¥¿ä¼šä¸ä¼šä¸€ä¸å°å¿ƒææˆé€’å½’äº†â€¦</p>
<blockquote>
<p>Another interesting thing this spider demonstrates is that, even if there are many quotes from the same author, we donâ€™t need to worry about visiting the same author page multiple times. By default, Scrapy filters out duplicated requests to URLs already visited, avoiding the problem of hitting servers too much because of a programming mistake. This can be configured by the setting DUPEFILTER_CLASS.</p>
</blockquote>
<p>è¯è¯´è¿™æ˜¯è‡ªå¸¦é˜²æ­¢é€’å½’çš„åŠŸèƒ½?æ¡†æ¶æœç„¶æ˜¯å¥½ä¸œè¥¿,æ€¥äººä¹‹æ‰€æ€¥å•Š</p>
<h3 id="ä¼ é€’å‚æ•°"><a href="#ä¼ é€’å‚æ•°" class="headerlink" title="ä¼ é€’å‚æ•°"></a>ä¼ é€’å‚æ•°</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"quotes_tags"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = <span class="string">'http://quotes.toscrape.com/'</span></span><br><span class="line">        tag = getattr(self, <span class="string">'tag'</span>, <span class="keyword">None</span>)</span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            url = url + <span class="string">'tag/'</span> + tag</span><br><span class="line">        <span class="keyword">yield</span> scrapy.Request(url, self.parse)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> quote <span class="keyword">in</span> response.css(<span class="string">'div.quote'</span>):</span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">'text'</span>: quote.css(<span class="string">'span.text::text'</span>).extract_first(),</span><br><span class="line">                <span class="string">'author'</span>: quote.css(<span class="string">'small.author::text'</span>).extract_first(),</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        next_page = response.css(<span class="string">'li.next a::attr(href)'</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> next_page <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            next_page = response.urljoin(next_page)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(next_page, self.parse)</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl quotes_tags -o quotes_tags.json -a tag=humor</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆè·å–çš„ç»“æœåªæœ‰humorç±»å‹çš„</p>
<blockquote>
<p>You can learn more about <a href="https://docs.scrapy.org/en/latest/topics/spiders.html#spiderargs" title="spider-arguments" target="_blank" rel="noopener">handling spider arguments here</a>.</p>
</blockquote>
<p>ä»Šå¤©å°±åˆ°è¿™é‡Œ,æ¶ˆåŒ–ä¸€ä¸‹.</p>

      
    </div>

    
      

  <div class="popular-posts-header">ç›¸å…³é˜…è¯»</div>
  <ul class="popular-posts">
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2017/04/08/pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®/" rel="bookmark">Pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2017/04/09/NLTK/" rel="bookmark">NLTK</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2017/04/17/NLTK-è‡ªåŠ¨åŒ–è¯­ä¹‰æ ‡æ³¨/" rel="bookmark">NLTK-è‡ªåŠ¨åŒ–è¯­ä¹‰æ ‡æ³¨</a></div>
      
    </li>
  
  </ul>


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
          
            <a href="/tags/spider/" rel="tag"><i class="fa fa-tag"></i> spider</a>
          
            <a href="/tags/Scrapy/" rel="tag"><i class="fa fa-tag"></i> Scrapy</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
              <div>
                

<script src="//cdn.jsdelivr.net/npm/ilyabirman-likely@2/release/likely.js"></script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/ilyabirman-likely@2/release/likely.css">


  


<div class="likely">
	
 	 	<div class="twitter">Tweet</div>
	
 	 	<div class="facebook">Share</div>
	
 	 	<div class="linkedin">Link</div>
	
 	 	<div class="gplus">Plus</div>
	
 	 	<div class="vkontakte">Share</div>
	
 	 	<div class="odnoklassniki">Class</div>
	
 	 	<div class="telegram">Send</div>
	
 	 	<div class="whatsapp">Send</div>
	
 	 	<div class="pinterest">Pin</div>
	
</div>

              </div>
            
            
              <div id="needsharebutton-postbottom">
                <span class="btn">
                  <i class="fa fa-share-alt" aria-hidden="true"></i>
                </span>
              </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/09/Macå‘½ä»¤/" rel="next" title="Macå‘½ä»¤">
                <i class="fa fa-chevron-left"></i> Macå‘½ä»¤
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/08/pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®/" rel="prev" title="Pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½®">
                Pythonå¼€å‘ç¯å¢ƒçš„ä¸€äº›é…ç½® <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/hollow_knight.jpg" alt="Hisashiburidane">
            
              <p class="site-author-name" itemprop="name">Hisashiburidane</p>
              <div class="site-description motion-element" itemprop="description">åŠªåŠ›,å¥‹æ–—</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/liudongmeng" title="GitHub &rarr; https://github.com/liudongmeng" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:hydraunicorn@gmail.com" title="E-Mail &rarr; mailto:hydraunicorn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://nlpfxb.github.io/" title="https://nlpfxb.github.io/" rel="noopener" target="_blank">æ™“æ³¢Â·æœ‰é’±äººÂ·ğŸ¶å¯Œè´µÂ·å†¯</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ammeyjohn.github.io/" title="https://ammeyjohn.github.io/" rel="noopener" target="_blank">Patrick</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://kaiminghe.com/" title="http://kaiminghe.com/" rel="noopener" target="_blank">çœŸÂ·å¤§ç¥</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#æœ€ç®€å•çš„çˆ¬ç½‘é¡µ"><span class="nav-number">1.</span> <span class="nav-text">æœ€ç®€å•çš„çˆ¬ç½‘é¡µ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Scrapy"><span class="nav-number">2.</span> <span class="nav-text">Scrapy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Scrapyå®‰è£…"><span class="nav-number">2.1.</span> <span class="nav-text">Scrapyå®‰è£…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scrapy-Tuurtorial"><span class="nav-number">2.2.</span> <span class="nav-text">Scrapy Tuurtorial</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æŠ“å–ç½‘é¡µ"><span class="nav-number">2.2.1.</span> <span class="nav-text">æŠ“å–ç½‘é¡µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSSSelectoræå–æ•°æ®"><span class="nav-number">2.2.2.</span> <span class="nav-text">CSSSelectoræå–æ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#extract-method"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">.extract() method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#regular-expressions"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">regular expressions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XPathæå–æ•°æ®"><span class="nav-number">2.2.3.</span> <span class="nav-text">XPathæå–æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿™é‡Œè®²å¦‚ä½•æå–æœ€ç»ˆçš„ç›®æ ‡æ•°æ®"><span class="nav-number">2.2.4.</span> <span class="nav-text">è¿™é‡Œè®²å¦‚ä½•æå–æœ€ç»ˆçš„ç›®æ ‡æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨Spiderä¸­æå–æ•°æ®"><span class="nav-number">2.2.5.</span> <span class="nav-text">åœ¨Spiderä¸­æå–æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¦‚ä½•æŒç»­æŸ¥æ‰¾æ‰€æœ‰ç½‘é¡µ"><span class="nav-number">2.2.6.</span> <span class="nav-text">å¦‚ä½•æŒç»­æŸ¥æ‰¾æ‰€æœ‰ç½‘é¡µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¼ é€’å‚æ•°"><span class="nav-number">2.2.7.</span> <span class="nav-text">ä¼ é€’å‚æ•°</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-battery-1"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hisashiburidane</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.2</div>




        








        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  



  






  















  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.2"></script>



  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  
  

<script>
  var disqus_config = function() {
    this.page.url = "https://liudongmeng.github.io/2017/04/08/Scrapyå…¥é—¨/";
    this.page.identifier = "2017/04/08/Scrapyå…¥é—¨/";
    this.page.title = 'Scrapyå…¥é—¨';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://sayonara-l.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    $(function() {
      var offsetTop = $('#comments').offset().top - $(window).height();
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        $(window).on('scroll.disqus_scroll', function() {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = $('#comments').offset().top - $(window).height();
          var scrollTop = $(window).scrollTop();

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            $(window).off('.disqus_scroll');
            loadComments();
          }
        });
      }
    });
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  
  
  <script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
              })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! More info at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + '1YIwJodingrc40me9MEjtcVN-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': '1YIwJodingrc40me9MEjtcVN-gzGzoHsz',
                'X-LC-Key': '3soCSK6DKfVD7oRO7RAkbsfi',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
            if (localhost.test(document.URL)) return;
            addCount(Counter);
          
        });
    });
  </script>



  

  
  

  
  

  


  
<script>
if ($('body').find('div.pdf').length) {
  $.ajax({
    type: 'GET',
    url: '//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js',
    dataType: 'script',
    cache: true,
    success: function() {
      $('body').find('div.pdf').each(function(i, o) {
        PDFObject.embed($(o).attr('target'), $(o), {
          pdfOpenParams: {
            navpanes: 0,
            toolbar: 0,
            statusbar: 0,
            pagemode: 'thumbs',
            view: 'FitH'
          },
          PDFJS_URL: '/lib/pdf/web/viewer.html',
          height: $(o).attr('height') || '500px'
        });
      });
    },
  });
}
</script>


  
<script>
if ($('body').find('pre.mermaid').length) {
  $.ajax({
    type: 'GET',
    url: '//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js',
    dataType: 'script',
    cache: true,
    success: function() {
      mermaid.initialize({
        theme: 'forest',
        logLevel: 3,
        flowchart: { curve: 'linear' },
        gantt: { axisFormat: '%m/%d/%Y' },
        sequence: { actorMargin: 50 }
      });
    }
  });
}
</script>


  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>
  <script>
    
      pbOptions = {};
      
        pbOptions.iconStyle = "box";
      
        pbOptions.boxForm = "horizontal";
      
        pbOptions.position = "bottomCenter";
      
        pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
        flOptions.iconStyle = "box";
      
        flOptions.boxForm = "horizontal";
      
        flOptions.position = "middleRight";
      
        flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>


  

  
  
  
    
  
  <script src="//cdn.bootcss.com/pangu/4.0.7/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  

  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      const selection = document.getSelection();
      const selected = selection.rangeCount > 0 ? selection.getRangeAt(0) : false;
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('Copied');
        else $(this).text('Copy failed');
      
      ta.blur(); // For iOS
      $(this).blur();
      if (selected) {
        selection.removeAllRanges();
        selection.addRange(selected);
      }
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
